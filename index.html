<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Billboard Hot 100 Viewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="min-h-screen bg-slate-100 flex items-center justify-center p-5">
    <div class="max-w-5xl mx-auto bg-white rounded-xl shadow p-6 text-center">
      <h1 class="text-4xl font-semibold mb-5">Billboard Hot 100 Viewer</h1>
      <p id="statusMessage" class="font-bold text-slate-500 mb-4">Loading...</p>

      <label
        for="fileInput"
        class="cursor-pointer rounded-md bg-blue-700 px-5 py-2 text-white hover:bg-blue-800"
      >
        Upload CSV File
      </label>
      <input id="fileInput" type="file" accept=".csv" class="hidden" />

      <div class="mt-5 overflow-x-auto rounded-lg shadow">
        <table id="table"></table>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script>
      const statusElement = document.getElementById("statusMessage");
      function setStatus(msg) {
        statusElement.textContent = msg;
        setTimeout(() => {
          if (statusElement.textContent === msg) statusElement.textContent = "";
        }, 3000);
      }

      function renderCell(tag, cell) {
        const el = document.createElement(tag);
        el.className = "text-lg";
        if (URL.canParse(cell)) {
          const img = document.createElement("img");
          img.src = cell;
          img.alt = "";
          img.loading = "lazy";
          img.className = "w-28 object-contain";
          el.appendChild(img);
        } else {
          el.textContent = cell;
        }
        return el;
      }

      function displayCSV(text) {
        const { data } = Papa.parse(text, { skipEmptyLines: true });
        const table = document.getElementById("table");
        table.textContent = "";

        data.forEach((row, i) => {
          const tag = i === 0 ? "th" : "td";
          const tr = document.createElement("tr");
          if (i === 0) tr.className = "bg-blue-700 text-white";

          const tdIndex = document.createElement(tag);
          tdIndex.className = "text-xl font-bold px-4 py-2";
          tdIndex.textContent = i === 0 ? "#" : i;
          tr.appendChild(tdIndex);

          row.forEach((cell) => {
            const td = renderCell(tag, cell);
            td.classList.add("px-4", "py-2");
            tr.appendChild(td);
          });

          table.appendChild(tr);
        });
      }

      document.getElementById("fileInput").addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
          displayCSV(event.target.result);
          setStatus(file.name + " loaded successfully!");
        };
        reader.readAsText(file);
      });

      async function loadCsv(url) {
        try {
          const response = await fetch(url);
          if (!response.ok) throw new Error("File not found");

          const text = await response.text();
          displayCSV(text);
          setStatus("");
        } catch (err) {
          console.error("Error loading file:", err);
          setStatus("File not found. Please upload a CSV file.");
        }
      }

      loadCsv("billboard_hot_100.csv");
    </script>
  </body>
</html>
